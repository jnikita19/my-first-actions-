name: Docker Build

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  docker:
    permissions:
      contents: read
      packages: write
      secrets: read  # Required for passing secrets
      security-events: write  # For security scans

    uses: AmanjotSinghSaini-int/ci-templates/.github/workflows/docker-build.yml@main
    with:
      image_name: ghcr.io/my-org/my-app:latest
      dockerfile_path: ./Dockerfile
      context: .
      build_args: "--no-cache"
      run_trivy: true
      continue_on_trivy_error: false
      run_gitleaks: true
      continue_on_gitleaks_error: true
      run_owasp: true
      continue_on_owasp_error: false
    
    # MUST HAVE: Pass secrets to reusable workflow
    secrets:
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed for commit details
